%hive

USE dbriskdatamart;

DROP TABLE IF EXISTS dbriskdatamart.MZM_MCV_VAR_CR_RESUMEN__${FECHA_CALIFICACION};
CREATE TABLE IF NOT EXISTS dbriskdatamart.MZM_MCV_VAR_CR_RESUMEN__${FECHA_CALIFICACION}
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'

LOCATION 's3://boi-banregio/datalake/data/InteligenciaRiesgos/M&M/MZM/MCV/MZM_MCV_VAR_CR_RESUMEN__${FECHA_CALIFICACION}' AS

SELECT
DISTINCT T1.RFC,
T1.FOLIO,
T1.FECHACONSULTA,
NUM_OP_ACC                 ,
NUM_BK_OP_ACC              ,
NUM_BK_PQ_OP_ACC           ,
NUM_BK_CS_OP_ACC           ,
NUM_BK_LSG_OP_ACC          ,
NUM_BK_R_OP_ACC            ,
NUM_BK_CF_OP_ACC           ,
NUM_BK_OTHER_OP_ACC        ,
NUM_LSE_OP_ACC             ,
NUM_LSE_PQ_OP_ACC          ,
NUM_LSE_CS_OP_ACC          ,
NUM_LSE_LSG_OP_ACC         ,
NUM_LSE_R_OP_ACC           ,
NUM_LSE_CF_OP_ACC          ,
NUM_LSE_OTHER_OP_ACC       ,
NUM_UN_CRE_OP_ACC          ,
NUM_UN_CRE_PQ_OP_ACC       ,
NUM_UN_CRE_CS_OP_ACC       ,
NUM_UN_CRE_LSG_OP_ACC      ,
NUM_UN_CRE_R_OP_ACC        ,
NUM_UN_CRE_CF_OP_ACC       ,
NUM_UN_CRE_OTHER_OP_ACC    ,
NUM_OTHER_FIN_OP_ACC       ,
NUM_OTHER_FIN_PQ_OP_ACC    ,
NUM_OTHER_FIN_CS_OP_ACC    ,
NUM_OTHER_FIN_LSG_OP_ACC   ,
NUM_OTHER_FIN_R_OP_ACC     ,
NUM_OTHER_FIN_CF_OP_ACC    ,
NUM_OTHER_FIN_OTHER_OP_ACC ,
NUM_GBN_OP_ACC             ,
NUM_GBN_PQ_OP_ACC          ,
NUM_GBN_CS_OP_ACC          ,
NUM_GBN_LSG_OP_ACC         ,
NUM_GBN_R_OP_ACC           ,
NUM_GBN_CF_OP_ACC          ,
NUM_GBN_OTHER_OP_ACC       ,
NUM_BRG_OP_ACC             ,
NUM_BRG_PQ_OP_ACC          ,
NUM_BRG_CS_OP_ACC          ,
NUM_BRG_LSG_OP_ACC         ,
NUM_BRG_R_OP_ACC           ,
NUM_BRG_CF_OP_ACC          ,
NUM_BRG_OTHER_OP_ACC       ,
NUM_BRG_LSE_OP_ACC         ,
NUM_BRG_LSE_PQ_OP_ACC      ,
NUM_BRG_LSE_CS_OP_ACC      ,
NUM_BRG_LSE_LSG_OP_ACC     ,
NUM_BRG_LSE_R_OP_ACC       ,
NUM_BRG_LSE_CF_OP_ACC      ,
NUM_BRG_LSE_OTHER_OP_ACC   ,
NUM_CL_ACC                 ,
NUM_BK_CL_ACC              ,
NUM_BK_PQ_CL_ACC           ,
NUM_BK_CS_CL_ACC           ,
NUM_BK_LSG_CL_ACC          ,
NUM_BK_R_CL_ACC            ,
NUM_BK_CF_CL_ACC           ,
NUM_BK_OTHER_CL_ACC        ,
NUM_LSE_CL_ACC             ,
NUM_LSE_PQ_CL_ACC          ,
NUM_LSE_CS_CL_ACC          ,
NUM_LSE_LSG_CL_ACC         ,
NUM_LSE_R_CL_ACC           ,
NUM_LSE_CF_CL_ACC          ,
NUM_LSE_OTHER_CL_ACC       ,
NUM_UN_CRE_CL_ACC          ,
NUM_UN_CRE_PQ_CL_ACC       ,
NUM_UN_CRE_CS_CL_ACC       ,
NUM_UN_CRE_LSG_CL_ACC      ,
NUM_UN_CRE_R_CL_ACC        ,
NUM_UN_CRE_CF_CL_ACC       ,
NUM_UN_CRE_OTHER_CL_ACC    ,
NUM_OTHER_FIN_CL_ACC       ,
NUM_OTHER_FIN_PQ_CL_ACC    ,
NUM_OTHER_FIN_CS_CL_ACC    ,
NUM_OTHER_FIN_LSG_CL_ACC   ,
NUM_OTHER_FIN_R_CL_ACC     ,
NUM_OTHER_FIN_CF_CL_ACC    ,
NUM_OTHER_FIN_OTHER_CL_ACC ,
NUM_GBN_CL_ACC             ,
NUM_GBN_PQ_CL_ACC          ,
NUM_GBN_CS_CL_ACC          ,
NUM_GBN_LSG_CL_ACC         ,
NUM_GBN_R_CL_ACC           ,
NUM_GBN_CF_CL_ACC          ,
NUM_GBN_OTHER_CL_ACC       ,
NUM_BRG_CL_ACC             ,
NUM_BRG_PQ_CL_ACC          ,
NUM_BRG_CS_CL_ACC          ,
NUM_BRG_LSG_CL_ACC         ,
NUM_BRG_R_CL_ACC           ,
NUM_BRG_CF_CL_ACC          ,
NUM_BRG_OTHER_CL_ACC       ,
NUM_BRG_LSE_CL_ACC         ,
NUM_BRG_LSE_PQ_CL_ACC      ,
NUM_BRG_LSE_CS_CL_ACC      ,
NUM_BRG_LSE_LSG_CL_ACC     ,
NUM_BRG_LSE_R_CL_ACC       ,
NUM_BRG_LSE_CF_CL_ACC      ,
NUM_BRG_LSE_OTHER_CL_ACC   ,
NUM_OP_ACC                   / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OP_ACC                 ,
NUM_BK_OP_ACC                / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_OP_ACC              ,
NUM_BK_PQ_OP_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_PQ_OP_ACC           ,
NUM_BK_CS_OP_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_CS_OP_ACC           ,
NUM_BK_LSG_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_LSG_OP_ACC          ,
NUM_BK_R_OP_ACC              / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_R_OP_ACC            ,
NUM_BK_CF_OP_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_CF_OP_ACC           ,
NUM_BK_OTHER_OP_ACC          / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_OTHER_OP_ACC        ,
NUM_LSE_OP_ACC               / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_OP_ACC             ,
NUM_LSE_PQ_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_PQ_OP_ACC          ,
NUM_LSE_CS_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_CS_OP_ACC          ,
NUM_LSE_LSG_OP_ACC           / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_LSG_OP_ACC         ,
NUM_LSE_R_OP_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_R_OP_ACC           ,
NUM_LSE_CF_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_CF_OP_ACC          ,
NUM_LSE_OTHER_OP_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_OTHER_OP_ACC       ,
NUM_UN_CRE_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_OP_ACC          ,
NUM_UN_CRE_PQ_OP_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_PQ_OP_ACC       ,
NUM_UN_CRE_CS_OP_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_CS_OP_ACC       ,
NUM_UN_CRE_LSG_OP_ACC        / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_LSG_OP_ACC      ,
NUM_UN_CRE_R_OP_ACC          / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_R_OP_ACC        ,
NUM_UN_CRE_CF_OP_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_CF_OP_ACC       ,
NUM_UN_CRE_OTHER_OP_ACC      / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_OTHER_OP_ACC    ,
NUM_OTHER_FIN_OP_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_OP_ACC       ,
NUM_OTHER_FIN_PQ_OP_ACC      / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_PQ_OP_ACC    ,
NUM_OTHER_FIN_CS_OP_ACC      / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_CS_OP_ACC    ,
NUM_OTHER_FIN_LSG_OP_ACC     / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_LSG_OP_ACC   ,
NUM_OTHER_FIN_R_OP_ACC       / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_R_OP_ACC     ,
NUM_OTHER_FIN_CF_OP_ACC      / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_CF_OP_ACC    ,
NUM_OTHER_FIN_OTHER_OP_ACC   / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_OTHER_OP_ACC ,
NUM_GBN_OP_ACC               / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_OP_ACC             ,
NUM_GBN_PQ_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_PQ_OP_ACC          ,
NUM_GBN_CS_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_CS_OP_ACC          ,
NUM_GBN_LSG_OP_ACC           / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_LSG_OP_ACC         ,
NUM_GBN_R_OP_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_R_OP_ACC           ,
NUM_GBN_CF_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_CF_OP_ACC          ,
NUM_GBN_OTHER_OP_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_OTHER_OP_ACC       ,
NUM_BRG_OP_ACC               / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_OP_ACC             ,
NUM_BRG_PQ_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_PQ_OP_ACC          ,
NUM_BRG_CS_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_CS_OP_ACC          ,
NUM_BRG_LSG_OP_ACC           / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSG_OP_ACC         ,
NUM_BRG_R_OP_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_R_OP_ACC           ,
NUM_BRG_CF_OP_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_CF_OP_ACC          ,
NUM_BRG_OTHER_OP_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_OTHER_OP_ACC       ,
NUM_BRG_LSE_OP_ACC           / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_OP_ACC         ,
NUM_BRG_LSE_PQ_OP_ACC        / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_PQ_OP_ACC      ,
NUM_BRG_LSE_CS_OP_ACC        / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_CS_OP_ACC      ,
NUM_BRG_LSE_LSG_OP_ACC       / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_LSG_OP_ACC     ,
NUM_BRG_LSE_R_OP_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_R_OP_ACC       ,
NUM_BRG_LSE_CF_OP_ACC        / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_CF_OP_ACC      ,
NUM_BRG_LSE_OTHER_OP_ACC     / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_OTHER_OP_ACC   ,
NUM_CL_ACC                   / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_CL_ACC                 ,
NUM_BK_CL_ACC                / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_CL_ACC              ,
NUM_BK_PQ_CL_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_PQ_CL_ACC           ,
NUM_BK_CS_CL_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_CS_CL_ACC           ,
NUM_BK_LSG_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_LSG_CL_ACC          ,
NUM_BK_R_CL_ACC              / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_R_CL_ACC            ,
NUM_BK_CF_CL_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_CF_CL_ACC           ,
NUM_BK_OTHER_CL_ACC          / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BK_OTHER_CL_ACC        ,
NUM_LSE_CL_ACC               / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_CL_ACC             ,
NUM_LSE_PQ_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_PQ_CL_ACC          ,
NUM_LSE_CS_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_CS_CL_ACC          ,
NUM_LSE_LSG_CL_ACC           / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_LSG_CL_ACC         ,
NUM_LSE_R_CL_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_R_CL_ACC           ,
NUM_LSE_CF_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_CF_CL_ACC          ,
NUM_LSE_OTHER_CL_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_LSE_OTHER_CL_ACC       ,
NUM_UN_CRE_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_CL_ACC          ,
NUM_UN_CRE_PQ_CL_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_PQ_CL_ACC       ,
NUM_UN_CRE_CS_CL_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_CS_CL_ACC       ,
NUM_UN_CRE_LSG_CL_ACC        / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_LSG_CL_ACC      ,
NUM_UN_CRE_R_CL_ACC          / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_R_CL_ACC        ,
NUM_UN_CRE_CF_CL_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_CF_CL_ACC       ,
NUM_UN_CRE_OTHER_CL_ACC      / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_UN_CRE_OTHER_CL_ACC    ,
NUM_OTHER_FIN_CL_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_CL_ACC       ,
NUM_OTHER_FIN_PQ_CL_ACC      / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_PQ_CL_ACC    ,
NUM_OTHER_FIN_CS_CL_ACC      / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_CS_CL_ACC    ,
NUM_OTHER_FIN_LSG_CL_ACC     / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_LSG_CL_ACC   ,
NUM_OTHER_FIN_R_CL_ACC       / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_R_CL_ACC     ,
NUM_OTHER_FIN_CF_CL_ACC      / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_CF_CL_ACC    ,
NUM_OTHER_FIN_OTHER_CL_ACC   / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_OTHER_FIN_OTHER_CL_ACC ,
NUM_GBN_CL_ACC               / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_CL_ACC             ,
NUM_GBN_PQ_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_PQ_CL_ACC          ,
NUM_GBN_CS_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_CS_CL_ACC          ,
NUM_GBN_LSG_CL_ACC           / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_LSG_CL_ACC         ,
NUM_GBN_R_CL_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_R_CL_ACC           ,
NUM_GBN_CF_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_CF_CL_ACC          ,
NUM_GBN_OTHER_CL_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_GBN_OTHER_CL_ACC       ,
NUM_BRG_CL_ACC               / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_CL_ACC             ,
NUM_BRG_PQ_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_PQ_CL_ACC          ,
NUM_BRG_CS_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_CS_CL_ACC          ,
NUM_BRG_LSG_CL_ACC           / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSG_CL_ACC         ,
NUM_BRG_R_CL_ACC             / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_R_CL_ACC           ,
NUM_BRG_CF_CL_ACC            / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_CF_CL_ACC          ,
NUM_BRG_OTHER_CL_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_OTHER_CL_ACC       ,
NUM_BRG_LSE_CL_ACC           / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_CL_ACC         ,
NUM_BRG_LSE_PQ_CL_ACC        / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_PQ_CL_ACC      ,
NUM_BRG_LSE_CS_CL_ACC        / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_CS_CL_ACC      ,
NUM_BRG_LSE_LSG_CL_ACC       / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_LSG_CL_ACC     ,
NUM_BRG_LSE_R_CL_ACC         / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_R_CL_ACC       ,
NUM_BRG_LSE_CF_CL_ACC        / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_CF_CL_ACC      ,
NUM_BRG_LSE_OTHER_CL_ACC     / (NUM_OP_ACC + NUM_CL_ACC) AS PCT_BRG_LSE_OTHER_CL_ACC   

FROM
    MZM_MCV_CR__${FECHA_CALIFICACION} T1
    
LEFT JOIN (SELECT RFC, FOLIO, 
COUNT( CASE WHEN ESTATUS = 'OP_ACC' THEN RFC ELSE NULL END)             AS NUM_OP_ACC                  ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BK ELSE NULL END)              AS NUM_BK_OP_ACC               ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BK_PQ ELSE NULL END)           AS NUM_BK_PQ_OP_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BK_CS ELSE NULL END)           AS NUM_BK_CS_OP_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BK_LSG ELSE NULL END)          AS NUM_BK_LSG_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BK_R ELSE NULL END)            AS NUM_BK_R_OP_ACC             ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BK_CF ELSE NULL END)           AS NUM_BK_CF_OP_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BK_OTHER ELSE NULL END)        AS NUM_BK_OTHER_OP_ACC         ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN LSE ELSE NULL END)             AS NUM_LSE_OP_ACC              ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN LSE_PQ ELSE NULL END)          AS NUM_LSE_PQ_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN LSE_CS ELSE NULL END)          AS NUM_LSE_CS_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN LSE_LSG ELSE NULL END)         AS NUM_LSE_LSG_OP_ACC          ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN LSE_R ELSE NULL END)           AS NUM_LSE_R_OP_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN LSE_CF ELSE NULL END)          AS NUM_LSE_CF_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN LSE_OTHER ELSE NULL END)       AS NUM_LSE_OTHER_OP_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN UN_CRE ELSE NULL END)          AS NUM_UN_CRE_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN UN_CRE_PQ ELSE NULL END)       AS NUM_UN_CRE_PQ_OP_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN UN_CRE_CS ELSE NULL END)       AS NUM_UN_CRE_CS_OP_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN UN_CRE_LSG ELSE NULL END)      AS NUM_UN_CRE_LSG_OP_ACC       ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN UN_CRE_R ELSE NULL END)        AS NUM_UN_CRE_R_OP_ACC         ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN UN_CRE_CF ELSE NULL END)       AS NUM_UN_CRE_CF_OP_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN UN_CRE_OTHER ELSE NULL END)    AS NUM_UN_CRE_OTHER_OP_ACC     ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN OTHER_FIN ELSE NULL END)       AS NUM_OTHER_FIN_OP_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN OTHER_FIN_PQ ELSE NULL END)    AS NUM_OTHER_FIN_PQ_OP_ACC     ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN OTHER_FIN_CS ELSE NULL END)    AS NUM_OTHER_FIN_CS_OP_ACC     ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN OTHER_FIN_LSG ELSE NULL END)   AS NUM_OTHER_FIN_LSG_OP_ACC    ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN OTHER_FIN_R ELSE NULL END)     AS NUM_OTHER_FIN_R_OP_ACC      ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN OTHER_FIN_CF ELSE NULL END)    AS NUM_OTHER_FIN_CF_OP_ACC     ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN OTHER_FIN_OTHER ELSE NULL END) AS NUM_OTHER_FIN_OTHER_OP_ACC  ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN GBN ELSE NULL END)             AS NUM_GBN_OP_ACC              ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN GBN_PQ ELSE NULL END)          AS NUM_GBN_PQ_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN GBN_CS ELSE NULL END)          AS NUM_GBN_CS_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN GBN_LSG ELSE NULL END)         AS NUM_GBN_LSG_OP_ACC          ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN GBN_R ELSE NULL END)           AS NUM_GBN_R_OP_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN GBN_CF ELSE NULL END)          AS NUM_GBN_CF_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN GBN_OTHER ELSE NULL END)       AS NUM_GBN_OTHER_OP_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG ELSE NULL END)             AS NUM_BRG_OP_ACC              ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_PQ ELSE NULL END)          AS NUM_BRG_PQ_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_CS ELSE NULL END)          AS NUM_BRG_CS_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_LSG ELSE NULL END)         AS NUM_BRG_LSG_OP_ACC          ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_R ELSE NULL END)           AS NUM_BRG_R_OP_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_CF ELSE NULL END)          AS NUM_BRG_CF_OP_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_OTHER ELSE NULL END)       AS NUM_BRG_OTHER_OP_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_LSE ELSE NULL END)         AS NUM_BRG_LSE_OP_ACC          ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_LSE_PQ ELSE NULL END)      AS NUM_BRG_LSE_PQ_OP_ACC       ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_LSE_CS ELSE NULL END)      AS NUM_BRG_LSE_CS_OP_ACC       ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_LSE_LSG ELSE NULL END)     AS NUM_BRG_LSE_LSG_OP_ACC      ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_LSE_R ELSE NULL END)       AS NUM_BRG_LSE_R_OP_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_LSE_CF ELSE NULL END)      AS NUM_BRG_LSE_CF_OP_ACC       ,
 SUM(  CASE WHEN ESTATUS = 'OP_ACC' THEN BRG_LSE_OTHER ELSE NULL END)   AS NUM_BRG_LSE_OTHER_OP_ACC    ,
 COUNT(CASE WHEN ESTATUS = 'CL_ACC' THEN RFC ELSE NULL END)             AS NUM_CL_ACC                  ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BK ELSE NULL END)              AS NUM_BK_CL_ACC               ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BK_PQ ELSE NULL END)           AS NUM_BK_PQ_CL_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BK_CS ELSE NULL END)           AS NUM_BK_CS_CL_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BK_LSG ELSE NULL END)          AS NUM_BK_LSG_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BK_R ELSE NULL END)            AS NUM_BK_R_CL_ACC             ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BK_CF ELSE NULL END)           AS NUM_BK_CF_CL_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BK_OTHER ELSE NULL END)        AS NUM_BK_OTHER_CL_ACC         ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN LSE ELSE NULL END)             AS NUM_LSE_CL_ACC              ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN LSE_PQ ELSE NULL END)          AS NUM_LSE_PQ_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN LSE_CS ELSE NULL END)          AS NUM_LSE_CS_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN LSE_LSG ELSE NULL END)         AS NUM_LSE_LSG_CL_ACC          ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN LSE_R ELSE NULL END)           AS NUM_LSE_R_CL_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN LSE_CF ELSE NULL END)          AS NUM_LSE_CF_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN LSE_OTHER ELSE NULL END)       AS NUM_LSE_OTHER_CL_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN UN_CRE ELSE NULL END)          AS NUM_UN_CRE_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN UN_CRE_PQ ELSE NULL END)       AS NUM_UN_CRE_PQ_CL_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN UN_CRE_CS ELSE NULL END)       AS NUM_UN_CRE_CS_CL_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN UN_CRE_LSG ELSE NULL END)      AS NUM_UN_CRE_LSG_CL_ACC       ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN UN_CRE_R ELSE NULL END)        AS NUM_UN_CRE_R_CL_ACC         ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN UN_CRE_CF ELSE NULL END)       AS NUM_UN_CRE_CF_CL_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN UN_CRE_OTHER ELSE NULL END)    AS NUM_UN_CRE_OTHER_CL_ACC     ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN OTHER_FIN ELSE NULL END)       AS NUM_OTHER_FIN_CL_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN OTHER_FIN_PQ ELSE NULL END)    AS NUM_OTHER_FIN_PQ_CL_ACC     ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN OTHER_FIN_CS ELSE NULL END)    AS NUM_OTHER_FIN_CS_CL_ACC     ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN OTHER_FIN_LSG ELSE NULL END)   AS NUM_OTHER_FIN_LSG_CL_ACC    ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN OTHER_FIN_R ELSE NULL END)     AS NUM_OTHER_FIN_R_CL_ACC      ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN OTHER_FIN_CF ELSE NULL END)    AS NUM_OTHER_FIN_CF_CL_ACC     ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN OTHER_FIN_OTHER ELSE NULL END) AS NUM_OTHER_FIN_OTHER_CL_ACC  ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN GBN ELSE NULL END)             AS NUM_GBN_CL_ACC              ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN GBN_PQ ELSE NULL END)          AS NUM_GBN_PQ_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN GBN_CS ELSE NULL END)          AS NUM_GBN_CS_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN GBN_LSG ELSE NULL END)         AS NUM_GBN_LSG_CL_ACC          ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN GBN_R ELSE NULL END)           AS NUM_GBN_R_CL_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN GBN_CF ELSE NULL END)          AS NUM_GBN_CF_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN GBN_OTHER ELSE NULL END)       AS NUM_GBN_OTHER_CL_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG ELSE NULL END)             AS NUM_BRG_CL_ACC              ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_PQ ELSE NULL END)          AS NUM_BRG_PQ_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_CS ELSE NULL END)          AS NUM_BRG_CS_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_LSG ELSE NULL END)         AS NUM_BRG_LSG_CL_ACC          ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_R ELSE NULL END)           AS NUM_BRG_R_CL_ACC            ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_CF ELSE NULL END)          AS NUM_BRG_CF_CL_ACC           ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_OTHER ELSE NULL END)       AS NUM_BRG_OTHER_CL_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_LSE ELSE NULL END)         AS NUM_BRG_LSE_CL_ACC          ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_LSE_PQ ELSE NULL END)      AS NUM_BRG_LSE_PQ_CL_ACC       ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_LSE_CS ELSE NULL END)      AS NUM_BRG_LSE_CS_CL_ACC       ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_LSE_LSG ELSE NULL END)     AS NUM_BRG_LSE_LSG_CL_ACC      ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_LSE_R ELSE NULL END)       AS NUM_BRG_LSE_R_CL_ACC        ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_LSE_CF ELSE NULL END)      AS NUM_BRG_LSE_CF_CL_ACC       ,
 SUM(  CASE WHEN ESTATUS = 'CL_ACC' THEN BRG_LSE_OTHER ELSE NULL END)   AS NUM_BRG_LSE_OTHER_CL_ACC    
 FROM MZM_MCV_CR__${FECHA_CALIFICACION} GROUP BY RFC, FOLIO) T100 ON T1.RFC = T100.RFC AND T1.FOLIO = T100.FOLIO;

SELECT * FROM dbriskdatamart.MZM_MCV_VAR_CR_RESUMEN__${FECHA_CALIFICACION} LIMIT 100;