%hive
use dbmymwork;
DROP TABLE IF EXISTS BTDC_LGG_VAR_R_CUR_BAL_BY_CRED_MAX;
CREATE TABLE BTDC_LGG_VAR_R_CUR_BAL_BY_CRED_MAX
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'

LOCATION 's3://boi-banregio/datalake/data/InteligenciaRiesgos/M&M/BTDC/VARIABLES/ BTDC_LGG_VAR_R_CUR_BAL_BY_CRED_MAX' AS
SELECT CUENTADEREFERENCIA,FECHA_CARTERA,

COUNT(R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC)    AS NUM_R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC   ,
COUNT(R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC)     AS NUM_R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC    ,
COUNT(R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC)  AS NUM_R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC ,
COUNT(R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC)   AS NUM_R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC  ,
COUNT(R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC)     AS NUM_R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC    ,
COUNT(R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC)  AS NUM_R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC ,
COUNT(R_CUR_BAL_BY_CRED_MAX_M_OP_ACC)      AS NUM_R_CUR_BAL_BY_CRED_MAX_M_OP_ACC     ,
COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC) AS NUM_R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC,
COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC)  AS NUM_R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC ,
COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC)    AS NUM_R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC   ,
COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC) AS NUM_R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC,
COUNT(R_CUR_BAL_BY_CRED_MAX_OP_ACC)        AS NUM_R_CUR_BAL_BY_CRED_MAX_OP_ACC       ,
COUNT(R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC)     AS NUM_R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC    ,
COUNT(R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ) AS NUM_R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ,
COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ) AS NUM_R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ,
COUNT(R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ) AS NUM_R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ,
COUNT(R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ) AS NUM_R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ,
COUNT(R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC) AS NUM_R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC,
COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC) AS NUM_R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC,

ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC)    / COUNT(R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC)    ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC   ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC)     / COUNT(R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC)     ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC    ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC)  / COUNT(R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC)  ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC)   / COUNT(R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC)   ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC  ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC)     / COUNT(R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC)     ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC    ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC)  / COUNT(R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC)  ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_M_OP_ACC)      / COUNT(R_CUR_BAL_BY_CRED_MAX_M_OP_ACC)      ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_M_OP_ACC     ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC) / COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC) ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC)  / COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC)  ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC)    / COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC)    ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC   ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC) / COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC) ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_OP_ACC)        / COUNT(R_CUR_BAL_BY_CRED_MAX_OP_ACC)        ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_OP_ACC       ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC)     / COUNT(R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC)     ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC    ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ) / COUNT(R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ) ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ) / COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ) ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ) / COUNT(R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ) ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ) / COUNT(R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ) ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC) / COUNT(R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC) ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC) / COUNT(R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC) ,4 ) AS AVG_R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC,

ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC)    , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC   ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC)     , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC    ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC)  , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC)   , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC  ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC)     , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC    ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC)  , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_M_OP_ACC)      , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_M_OP_ACC     ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC) , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC)  , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC)    , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC   ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC) , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_OP_ACC)        , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_OP_ACC       ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC)     , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC    ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ) , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ) , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ) , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ) , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC) , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC,
ROUND(MAX(R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC) , 4 ) AS MAX_R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC,

ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC)    , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_AMX_OP_ACC   ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC)     , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_AU_OP_ACC    ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC)  , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_BK_AU_OP_ACC ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC)   , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_BK_M_OP_ACC  ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC)     , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_BK_OP_ACC    ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC)  , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_BK_PL_OP_ACC ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_M_OP_ACC)      , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_M_OP_ACC     ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC) , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_NBK_AU_OP_ACC,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC)  , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_NBK_M_OP_ACC ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC)    , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_NBK_OP_ACC   ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC) , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_NBK_PL_OP_ACC,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_OP_ACC)        , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_OP_ACC       ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC)     , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_PL_OP_ACC    ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ) , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_BK_R_OP_ACC  ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ) , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_NBK_R_OP_ACC ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ) , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_R_OP_ACC     ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ) , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_TU_OP_ACC    ,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC) , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_TU_ALL_OP_ACC,
ROUND(SUM(R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC) , 4 ) AS SUM_R_CUR_BAL_BY_CRED_MAX_NBK_TU_OP_ACC

FROM BTDC_LGG_VAR_SEGMENTADAS_1
GROUP BY CUENTADEREFERENCIA,FECHA_CARTERA;

SELECT * FROM BTDC_LGG_VAR_R_CUR_BAL_BY_CRED_MAX LIMIT 100;